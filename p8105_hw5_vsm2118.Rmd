---
title: "HW 5 Data Science"
author: "Victoria Mello (vsm2118)"
date: "November 13, 2023"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(rvest)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

```{r}

```


## Problem 2

```{r}
 # Step 1: Get all file names
file_names <- list.files(path = "./data", pattern = ".csv", full.names = TRUE)

# Step 2: Use purrr::map to read in data for each subject
data_list <- map(file_names, ~read_csv(.x) %>%
                   mutate(subject_id = gsub("[^0-9]", "", .x),
                          arm = ifelse(grepl("con", .x), "control", "experimental")))

# Step 3: Tidy the data
tidy_data <- bind_rows(data_list) %>% 
  pivot_longer(cols = starts_with("week_"), names_to = "week", values_to = "observation") %>% 
  mutate(week = as.numeric(str_remove(week, "week_")))

view(tidy_data)

# Step 4: Create a spaghetti plot
study_plot <- ggplot(tidy_data, aes(x = week, y = observation, color = factor(subject_id), group = interaction(subject_id, arm))) +
  geom_line() +
  geom_point() +
  facet_wrap(~arm, scales = "free_y") + 
  labs(title = "Spaghetti Plot of Observation Values of Subjects in Control vs Experimental Study Arms Over 8 Weeks",
       x = "Week",
       y = "Observation Value",
       color = "Subject ID") +
  theme_minimal()

print(study_plot)
```

The control group consistently maintains observation values within the range of roughly -2.3 to 4.3 throughout all 8 weeks, encompassing all 10 subjects. Notably, the minimum observation occurs in week 6 for subject 5, while the maximum is recorded in week 5 for subject 10. Conversely, the experimental arm exhibits a consistent positive/upward trajectory in observation values across all subjects throughout the 8-week duration. Subject 1 in the experimental arm records the lowest observation value in week 1, while the peak is observed in week 9 for subject 5. This suggests a positive correlation between observation values and weeks (time) in the experimental arm, a trend not observed in the control arm.


## Problem 3

```{r}
# Set seed for reproducibility
set.seed(12345)

# Function to simulate one-sample t-test and return estimate and p-value
sim_t_test <- function(true_mean = 0, true_sd = 5, n_obs = 30) {
  x <- rnorm(n = n_obs, mean = true_mean, sd = true_sd)
  t_test_result <- broom::tidy(t.test(x))
  
  tibble(
    true_mean = true_mean,
    estimate_mean = t_test_result$estimate,
    p_value = t_test_result$p.value
  )
}

```

